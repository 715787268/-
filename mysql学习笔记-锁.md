# 锁

## 1.什么是锁
  
  锁是一种对共享资源并发访问的管理机制。
  对于MyISAM引擎，它的锁是表锁设计，并发情况下读没有问题，但是写的性能就差了点。InnoDB引擎锁的实现和Oracle类似，提供一致性的非锁定读、行级锁支持。
  行级锁没有相关额外的开销，并可以同时得到并发性和一致性。
  
## 2.lock与latch

lock与latch都可以称为锁，但是两者的意义截然不同，latch一般称为闩锁（轻量级锁），因为它要求锁定的时间必须非常短，否则应用的性能会很差，在innoDB中，latch又可以分为mutex（互斥锁）和rwlock（读写锁），目的是用来保证并发线程操作临界资源的正确性，通常没有死锁检测的机制。

lock的对象是事务，用来锁定的是数据库中的对象，如表、页、行。并且一般lock的对象仅在事务commit或rollback后释放（不同事务隔离 级别释放的时间可能不同）。此外，lock有死锁机制。

| Left-Aligned  | lock | latch|
| :------------ |:---------------:| -----:|
|对象      | 事务 | 线程 |
| 保护    | 数据库内容        |   内存数据结构 |
| 模式 | 行锁、表锁、意向锁       |    读写锁、互斥量 |
| 死锁 | 通过waits-for graph、time out等机制进行死锁检测       |  无|
| 存在于 | Lock Manager的hash表中       |  每个数据结构的对象中|

在innoDB中，可以通过show engine innodb mutex进行查看latch信息
